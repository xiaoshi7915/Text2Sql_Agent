"use strict";(self["webpackChunkwenshu_mcp_frontend"]=self["webpackChunkwenshu_mcp_frontend"]||[]).push([[792],{8792:function(e,l,a){a.r(l),a.d(l,{default:function(){return g}});var o=a(6768),r=a(4232);const t={class:"datasource-form-container"},u={class:"card-header"},d={class:"form-section-title"},s={key:0},n={class:"form-actions"};function m(e,l,a,m,i,c){const p=(0,o.g2)("el-input"),b=(0,o.g2)("el-form-item"),f=(0,o.g2)("el-option"),h=(0,o.g2)("el-select"),g=(0,o.g2)("el-input-number"),v=(0,o.g2)("icon-arrow-down"),k=(0,o.g2)("el-icon"),y=(0,o.g2)("icon-arrow-right"),F=(0,o.g2)("el-button"),V=(0,o.g2)("el-switch"),S=(0,o.g2)("el-form"),w=(0,o.g2)("el-card"),_=(0,o.gN)("loading");return(0,o.uX)(),(0,o.CE)("div",t,[(0,o.bF)(w,null,{header:(0,o.k6)((()=>[(0,o.Lk)("div",u,[(0,o.Lk)("h3",null,(0,r.v_)(m.isEdit?"编辑数据源":"新建数据源"),1)])])),default:(0,o.k6)((()=>[(0,o.bo)(((0,o.uX)(),(0,o.Wv)(S,{ref:"formRef",model:m.form,rules:m.rules,"label-width":"120px",class:"datasource-form"},{default:(0,o.k6)((()=>[l[18]||(l[18]=(0,o.Lk)("h4",{class:"form-section-title"},"基本信息",-1)),(0,o.bF)(b,{label:"数据源名称",prop:"name"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{modelValue:m.form.name,"onUpdate:modelValue":l[0]||(l[0]=e=>m.form.name=e),placeholder:"请输入数据源名称"},null,8,["modelValue"])])),_:1}),(0,o.bF)(b,{label:"数据库类型",prop:"type"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{modelValue:m.form.type,"onUpdate:modelValue":l[1]||(l[1]=e=>m.form.type=e),placeholder:"请选择数据库类型",style:{width:"100%"}},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(m.dbTypeOptions,(e=>((0,o.uX)(),(0,o.Wv)(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.bF)(b,{label:"描述"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{modelValue:m.form.description,"onUpdate:modelValue":l[2]||(l[2]=e=>m.form.description=e),type:"textarea",rows:4,placeholder:"请输入数据源描述信息"},null,8,["modelValue"])])),_:1}),l[19]||(l[19]=(0,o.Lk)("h4",{class:"form-section-title"},"连接信息",-1)),(0,o.bF)(b,{label:"主机地址",prop:"host"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{modelValue:m.form.host,"onUpdate:modelValue":l[3]||(l[3]=e=>m.form.host=e),placeholder:"请输入主机地址"},null,8,["modelValue"])])),_:1}),(0,o.bF)(b,{label:"端口",prop:"port"},{default:(0,o.k6)((()=>[(0,o.bF)(g,{modelValue:m.form.port,"onUpdate:modelValue":l[4]||(l[4]=e=>m.form.port=e),min:1,max:65535,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),(0,o.bF)(b,{label:"数据库名称",prop:"database"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{modelValue:m.form.database,"onUpdate:modelValue":l[5]||(l[5]=e=>m.form.database=e),placeholder:"请输入数据库名称"},null,8,["modelValue"])])),_:1}),(0,o.bF)(b,{label:"用户名",prop:"username"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{modelValue:m.form.username,"onUpdate:modelValue":l[6]||(l[6]=e=>m.form.username=e),placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),(0,o.bF)(b,{label:"密码",prop:"password"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{modelValue:m.form.password,"onUpdate:modelValue":l[7]||(l[7]=e=>m.form.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1}),(0,o.Lk)("h4",d,[(0,o.bF)(F,{link:"",type:"primary",onClick:l[8]||(l[8]=e=>m.showAdvanced=!m.showAdvanced)},{default:(0,o.k6)((()=>[m.showAdvanced?((0,o.uX)(),(0,o.Wv)(k,{key:0},{default:(0,o.k6)((()=>[(0,o.bF)(v)])),_:1})):((0,o.uX)(),(0,o.Wv)(k,{key:1},{default:(0,o.k6)((()=>[(0,o.bF)(y)])),_:1})),l[14]||(l[14]=(0,o.eW)(" 高级配置 "))])),_:1})]),m.showAdvanced?((0,o.uX)(),(0,o.CE)("div",s,[(0,o.bF)(b,{label:"连接超时(秒)"},{default:(0,o.k6)((()=>[(0,o.bF)(g,{modelValue:m.form.timeout,"onUpdate:modelValue":l[9]||(l[9]=e=>m.form.timeout=e),min:1,max:300,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),(0,o.bF)(b,{label:"连接池大小"},{default:(0,o.k6)((()=>[(0,o.bF)(g,{modelValue:m.form.poolSize,"onUpdate:modelValue":l[10]||(l[10]=e=>m.form.poolSize=e),min:1,max:100,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),(0,o.bF)(b,{label:"字符集"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{modelValue:m.form.charset,"onUpdate:modelValue":l[11]||(l[11]=e=>m.form.charset=e),placeholder:"请选择字符集",style:{width:"100%"}},{default:(0,o.k6)((()=>[(0,o.bF)(f,{label:"UTF-8",value:"utf8"}),(0,o.bF)(f,{label:"GBK",value:"gbk"}),(0,o.bF)(f,{label:"UTF-16",value:"utf16"}),(0,o.bF)(f,{label:"ASCII",value:"ascii"})])),_:1},8,["modelValue"])])),_:1}),(0,o.bF)(b,{label:"元数据刷新"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{modelValue:m.form.metadataRefresh,"onUpdate:modelValue":l[12]||(l[12]=e=>m.form.metadataRefresh=e),placeholder:"请选择元数据刷新方式",style:{width:"100%"}},{default:(0,o.k6)((()=>[(0,o.bF)(f,{label:"手动",value:"manual"}),(0,o.bF)(f,{label:"每天",value:"daily"}),(0,o.bF)(f,{label:"每周",value:"weekly"}),(0,o.bF)(f,{label:"每月",value:"monthly"})])),_:1},8,["modelValue"])])),_:1}),(0,o.bF)(b,{label:"SSL连接"},{default:(0,o.k6)((()=>[(0,o.bF)(V,{modelValue:m.form.useSSL,"onUpdate:modelValue":l[13]||(l[13]=e=>m.form.useSSL=e)},null,8,["modelValue"])])),_:1})])):(0,o.Q3)("",!0),(0,o.Lk)("div",n,[(0,o.bF)(F,{onClick:m.handleCancel},{default:(0,o.k6)((()=>l[15]||(l[15]=[(0,o.eW)("取消")]))),_:1},8,["onClick"]),(0,o.bF)(F,{type:"primary",onClick:m.handleSubmit},{default:(0,o.k6)((()=>l[16]||(l[16]=[(0,o.eW)("保存")]))),_:1},8,["onClick"]),(0,o.bF)(F,{type:"success",onClick:m.handleTest},{default:(0,o.k6)((()=>l[17]||(l[17]=[(0,o.eW)("测试连接")]))),_:1},8,["onClick"])])])),_:1},8,["model","rules"])),[[_,m.loading]])])),_:1})])}a(4114),a(8111),a(7588);var i=a(144),c=a(1387),p=a(1219),b={name:"DataSourceForm",props:{id:{type:[String,Number],required:!1}},setup(e){const l=(0,c.lq)(),a=(0,c.rd)(),r=(0,i.KR)(null),t=(0,i.KR)(!1),u=(0,i.KR)(!1),d=(0,o.EW)((()=>!!e.id||!!l.params.id)),s=(0,o.EW)((()=>e.id||l.params.id)),n=[{value:"MySQL",label:"MySQL"},{value:"PostgreSQL",label:"PostgreSQL"},{value:"SQLServer",label:"SQL Server"},{value:"Oracle",label:"Oracle"}],m=(0,i.Kh)({name:"",type:"MySQL",description:"",host:"",port:3306,database:"",username:"",password:"",timeout:30,poolSize:10,charset:"utf8",metadataRefresh:"manual",useSSL:!1}),b={name:[{required:!0,message:"请输入数据源名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择数据库类型",trigger:"change"}],host:[{required:!0,message:"请输入主机地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口号",trigger:"blur"},{type:"number",message:"端口必须为数字",trigger:"blur"}],database:[{required:!0,message:"请输入数据库名称",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!d.value,message:"请输入密码",trigger:"blur"}]},f=e=>{const l={MySQL:3306,PostgreSQL:5432,SQLServer:1433,Oracle:1521};m.port=l[e]||3306},h=()=>{f(m.type)},g=async()=>{if(d.value){t.value=!0;try{setTimeout((()=>{const e={id:s.value,name:"生产环境MySQL数据库",type:"MySQL",description:"这是生产环境的主MySQL数据库，包含核心业务数据",host:"192.168.1.100",port:3306,database:"production_db",username:"root",password:"",timeout:30,poolSize:10,charset:"utf8",metadataRefresh:"daily",useSSL:!0};Object.keys(m).forEach((l=>{void 0!==e[l]&&(m[l]=e[l])})),t.value=!1}),500)}catch(e){console.error("获取数据源详情失败",e),p.nk.error("获取数据源详情失败"),t.value=!1}}},v=async()=>{r.value&&r.value.validate((async e=>{if(!e)return!1;t.value=!0;try{setTimeout((()=>{t.value=!1,(0,p.nk)({message:d.value?"数据源更新成功":"数据源创建成功",type:"success"}),a.push("/datasource/list")}),1e3)}catch(l){console.error("保存数据源失败",l),p.nk.error("保存数据源失败"),t.value=!1}}))},k=async()=>{r.value&&r.value.validate((async e=>{if(!e)return!1;t.value=!0;try{setTimeout((()=>{t.value=!1;const e=Math.random()>.3;e?(0,p.nk)({message:"数据库连接成功",type:"success"}):(0,p.nk)({message:"数据库连接失败，请检查配置",type:"error"})}),1500)}catch(l){console.error("测试连接失败",l),p.nk.error("测试连接失败"),t.value=!1}}))},y=()=>{a.push("/datasource/list")};return(0,o.sV)((()=>{g()})),{formRef:r,loading:t,isEdit:d,form:m,rules:b,dbTypeOptions:n,showAdvanced:u,handleSubmit:v,handleTest:k,handleCancel:y,watchDbTypeChange:h}}},f=a(1241);const h=(0,f.A)(b,[["render",m],["__scopeId","data-v-56cc0274"]]);var g=h}}]);
//# sourceMappingURL=792.324069e8.js.map